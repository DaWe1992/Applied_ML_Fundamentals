% load packages
\RequirePackage{tcolorbox}
\RequirePackage{tikz}

\tcbuselibrary{skins}

% =============================================
% =============================================

% adjust margin left and right
\setbeamersize{text margin left=25pt,text margin right=25pt}


% define colors
% =============================================
\setbeamercolor{frametitle}{fg=black}
\setbeamercolor{itemize item}{fg=black}
\setbeamercolor{itemize subitem}{fg=black}
\setbeamercolor{caption name}{fg=black!80!white}
\setbeamercolor{section in toc}{fg=black}
\setbeamercolor{subsection in toc}{fg=gray!20!black}


% define fonts and sizes
% =============================================
\setbeamerfont{frametitle}{series=\bf,size=\footnotesize}
\setbeamerfont{caption name}{series=\bf}
\setbeamertemplate{itemize/enumerate subbody begin}{\normalsize}
\setbeamertemplate{itemize/enumerate subsubbody begin}{\small}
\usefonttheme[onlymath]{serif}


% Table of contents
% =============================================
\makeatletter
\def\beamer@endinputifotherversion#1{}
\def\beamer@sectionintoc#1#2#3#4#5{{\large \vspace*{3mm} \textbf{#2} \hfill \textbf{#3} \par}}
\def\beamer@subsectionintoc#1#2#3#4#5#6{{\normalsize \hspace*{3mm} \textbf{#3} \hfill \textbf{#4} \par}}
\def\beamer@subsubsectionintoc#1#2#3#4#5#6#7{{\normalsize \hspace*{6mm} \textbf{#4} \hfill #5 \par}}
\makeatother


% define bullet points
% =============================================
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}{--}
\setbeamertemplate{itemize subsubitem}{\textcolor{black}{$\triangleright$}}
\setlength{\leftmargini}{3.5mm}
\setlength{\leftmarginii}{3.5mm}
\setlength{\leftmarginiii}{3.5mm}


% frametitle
% =============================================
\setbeamertemplate{frametitle}{%
	\vspace*{1mm}
	\ifthenelse{\boolean{deeptoc}}{
		\ifnum\insertframenumber=\insertsectionstartpage%
			\vspace*{0.1mm}
    			\begin{tcolorbox}[
				skin=enhanced,
      				boxrule=0.6mm, boxsep=0mm,
     	   			lowerbox=ignored,
        			colback=orange!60!red, colframe=black,
        			borderline={0.5pt}{3pt}{black}, borderline={1pt}{2pt}{red}
    			]
        			\centering
        			\Huge\textbf\insertsectionhead\par
    			\end{tcolorbox}
		\fi%
	}{}
	\ifnum\insertframenumber=\insertsubsectionstartpage%
    		\vspace*{0.1mm}
    		\begin{tcolorbox}[
     		   	boxrule=0.4mm, boxsep=-0.5mm,
     	   		lowerbox=ignored,
     	   		colback=yellow!60!orange, colframe=black
    		]
        		\centering
        		\huge\textbf\insertsubsectionhead\par
   	 	\end{tcolorbox}
	\fi%
	\begin{tcolorbox}[
    		boxrule=0.2mm,
    		boxsep=0mm,
    		lowerbox=ignored,
    		colback=yellow, colframe=black
	]
    		\centering
    		\large\insertframetitle
	\end{tcolorbox}
}


% customize captions
% =============================================
\setbeamertemplate{caption}{%
	\begin{tcolorbox}[
		colback=lightgray, colframe=black,
		width=.17\linewidth,
		height=17pt,
		boxrule=0.5pt, boxsep=-1pt
	]
		\textbf{\strut\insertcaptionname~\insertcaptionnumber%
		\usebeamertemplate{caption label separator}}%
	\end{tcolorbox}%
	\space%
	\begin{tcolorbox}[
		colback=lightgray, colframe=black,
		width=.82\linewidth,
		height=17pt,
		boxrule=0.5pt, boxsep=-1pt
	]
		\strut\insertcaption%
	\end{tcolorbox}%
}


% header and Footer
% =============================================

% header
\setbeamertemplate{headline}{
	% skip header line on first frame of section
	\ifnum\insertsectionstartframe=\insertframenumber%
     		\vskip-\headheight%
	\else
		\begin{beamercolorbox}[wd=\textwidth,ht=4mm,dp=1mm]{}
			\hspace*{25pt} \Fheadline \hspace{25pt}
		\end{beamercolorbox}
		\centerline{\rule{\linewidth}{.2pt}}
	\fi
}

\setbeamertemplate{footline}{%
	\centerline{\rule{\linewidth}{.2pt}}
	\begin{beamercolorbox}[wd=\textwidth,ht=2mm,dp=3mm]{}
		\hspace*{25pt} \Ffootline \hspace{25pt}
	\end{beamercolorbox}
}

% definition of header
\newcommand{\Fheadline}{
	\ifx\insertshorttitle\undefined
		\inserttitle
	\else
		\insertshorttitle
	\fi
	\hfill
	\insertsection
}

% definition of footer
\newcommand{\Ffootline}{
	\textbf{\insertauthor,~\insertinstitute,~\insertdate}
	\hfill
	\insertframenumber
}

% remove navigation symbols
\setbeamertemplate{navigation symbols}{}


% remove header line on first frame of section
% =============================================
\makeatletter
\newcount\beamer@sectionstartframe
\beamer@sectionstartframe=1
\apptocmd{\beamer@section}{\addtocontents{nav}{\protect\headcommand{%
            \protect\beamer@sectionframes{\the\beamer@sectionstartframe}{\the\c@framenumber}}}
}{}{}
\apptocmd{\beamer@section}%
{\beamer@sectionstartframe=\c@framenumber\advance\beamer@sectionstartframe by1\relax}{}{}
\AtEndDocument{
	\immediate\write\@auxout{\string\@writefile{nav}%
        	{\noexpand\headcommand{\noexpand\beamer@sectionframes{\the\beamer@sectionstartframe}%
	{\the\c@framenumber}}}}
}{}{}

\def\beamer@startframeofsection{1}
\def\beamer@endframeofsection{1}
\def\beamer@sectionframes#1#2{%
    		\ifnum\c@framenumber<#1%
    		\else%
    			\ifnum\c@framenumber>#2%
    			\else%
    				\gdef\beamer@startframeofsection{#1}%
    				\gdef\beamer@endframeofsection{#2}%
    			\fi%
    		\fi%
}

\newcommand\insertsectionstartframe{\beamer@startframeofsection}
\newcommand\insertsectionendframe{\beamer@endframeofsection}
\makeatother
